import{y as _,r as C,z as S,s as $,o as l,c as o,a as t,h as v,t as c,u,e as P,f as B,x as N,A as V,b as g,v as y,n as w,F as r,g as h}from"./index.8a00fc3d.js";import{h as x,_ as j}from"./http.ea3b52c8.js";import{_ as A}from"./NoData.7040c805.js";const D={class:"p-5 !pt-24 lg:p-16 h-full w-full flex flex-col max-w-5xl mx-auto flex-1"},M={class:"min-h-full w-full flex flex-1"},E={key:2,class:"flex flex-col w-full"},F={class:"flex w-full gap-x-5 justify-center"},R=["src"],T={class:"flex flex-col font-bold w-64"},U={class:"text-lg lg:text-2xl uppercase"},Y={class:"flex w-full justify-between"},Z=t("span",null,"Showdate:",-1),q=t("div",{class:"dots flex-grow"},null,-1),G={class:"flex w-full justify-between"},L=t("span",null,"Daytime:",-1),H=t("div",{class:"dots flex-grow"},null,-1),I={class:"h-20 flex flex-col text-error my-5"},J=["onSubmit"],K=["disabled"],O={class:"flex flex-col mt-16 gap-3 w-full"},Q={class:"flex gap-2 font-bold text-xl"},W=t("span",null,"Row",-1),X={class:"places-grid mx-auto"},ee=["disabled","title","onClick"],ne={__name:"Checkout",setup(te){const b=s=>s.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),{movie_id:d,showdate:m,daytime:f}=_.currentRoute.value.query,e=C({available:!0,loading:!0,places:null,selected:{row:null,seat:null},info:{name:"",email:""},movie:_.options.history.state.movie,submitting:!1}),p=S(()=>{const s=[];return!e.selected.row&&!e.selected.seat&&s.push("Please select seat"),e.info.name||s.push("Please enter your name"),b(e.info.email)||s.push("Please enter valid email"),s});$(async()=>{try{e.loading=!0,e.movie||await x.get("/movies",{params:{movie_id:d}}).then(({data:i})=>e.movie=i.data[0]);const{data:s}=await x.get("/showPlaces",{params:{movie_id:d,showdate:m,daytime:f}});e.places=s.data}catch{}finally{e.loading=!1}});const k=async()=>{try{if(p.value.length)return;e.submitting=!0;const{data:s}=await x.post("/bookPlace",{movie_id:d,...e.selected,showdate:m,daytime:f});s.data.movieName=e.movie.name,s.data.name=e.info.name,s.data.email=e.info.email,_.push({name:"success",params:{id:s.data.ticketkey},state:{...s}})}catch{}finally{e.submitting=!1}};return(s,i)=>(l(),o("main",D,[t("div",M,[e.loading?(l(),v(j,{key:0,size:"32",class:"m-auto"})):e.places?(l(),o("div",E,[t("div",F,[t("img",{class:"h-32 lg:h-64 w-auto mt-0",src:e.movie.image},null,8,R),t("div",T,[t("h2",U,c(e.movie.name),1),t("span",Y,[Z,q,t("span",null,c(u(m)),1)]),t("span",G,[L,H,t("span",null,c(u(f)),1)]),t("div",I,[P(N,null,{default:B(()=>[(l(!0),o(r,null,h(u(p),a=>(l(),o("span",{key:a},c(a),1))),128))]),_:1})]),t("form",{class:"flex flex-col gap-5",onSubmit:V(k,["prevent"])},[g(t("input",{"onUpdate:modelValue":i[0]||(i[0]=a=>e.info.name=a),type:"text",placeholder:"Your name",class:"input input-bordered input-primary w-full input-sm max-w-xs"},null,512),[[y,e.info.name]]),g(t("input",{"onUpdate:modelValue":i[1]||(i[1]=a=>e.info.email=a),type:"text",placeholder:"Your email",class:"input input-bordered input-primary w-full input-sm max-w-xs"},null,512),[[y,e.info.email]]),t("button",{disabled:u(p).length,class:w(["btn mr-0 ml-auto",{loading:e.submitting}]),type:"submit"}," book ",10,K)],40,J)])]),t("div",O,[(l(!0),o(r,null,h(e.places,([{row:a},z])=>(l(),o(r,{key:a},[t("span",Q,[W,t("span",null,c(a),1)]),t("div",X,[(l(!0),o(r,null,h(z,n=>(l(),o("button",{key:n.seat,disabled:!n.is_free,title:n.is_free?`Select seat ${n.seat} at row ${a}`:"Not available",class:w([{"btn-link":e.selected.row===a&&e.selected.seat===n.seat},"btn"]),onClick:se=>(e.selected.row=a,e.selected.seat=n.seat)},c(n.seat),11,ee))),128))])],64))),128))])])):(l(),v(A,{key:1,size:"32",class:"m-auto"}))])]))}};export{ne as default};
